<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Codyssi 2025 - 17</title>
</head>
<body>
    <script src="input.js"></script>
    <script src="script.js"></script>
    <pre>
Part 2
Difficulty Rating: 6
Great! I guess you can make your way out of here now?

“Wait, don’t! There’s a well-concealed flap on this sign. If you take it off, the sign actually tells you to consider all the staircase branches! We can’t ignore the branching staircases!”

Your team almost fell for the oldest trick in the book. Wow.

You re-read the sign. Ahead of you, there are 150 staircases: 1 main staircase (S1) and 149 branching staircases (S2 to S150).

Each branching staircase is notated in the form ‘S{X} : {N1} -> {N2} : FROM S{A} TO S{B}’, where X, N1, N2, A, and B are integers. For this notation, the ID of the branching staircase is “SX”. The staircase “SX” has (N2 - N1) + 1 total steps: the first step has notation SX_N1 and the final step has notation SX_N2. The staircase “SX” branches from staircase “SA” at its start, and connects to staircase “SB” at its end.

Staircase “SA” is considered as the ‘feeding staircase’ of “SX”, and “SB” is considered as the ‘return staircase’ of “SX”.

Branching staircases function as follows:


Moving between staircases counts as one step traversed. For example, S1_1 to S2_1 is a move of magnitude 1, and S1_1 to S2_2 is a move of magnitude 2.

In a move, you cannot return to a step that you have travelled from. For example, S1_1 to S2_1 to S1_1 is not a valid move, because it returns to the step S1_1 after travelling from S1_1.

Additionally, you cannot return to a step that you have passed earlier in your path. For example, the path S1_1-S2_1-S1_1 is not valid, because it returns to the step S1_1 which was present earlier in the path.

Branching staircases can cause a move to have several magnitudes. For example, S1_1 to S2_1 to S2_2 to S2_3 to S1_3 has magnitude 4, but S1_1 to S1_2 to S1_3 has magnitude 2.

If one of the possible magnitudes of a move is valid, then the move is valid.

A move with many possible intermediate routes is still treated as one move. In the previous example, the notation is still S1_1-S1_3 regardless of the intermediate route taken.



You still cannot traverse backwards down the staircase. For example, S1_3 to S1_2 to S2_2 is not a legal move, as it involves a backwards traversal. The move S1_3 to S1_2 to S2_2 to S2_3 to S2_4 is also not a legal move, as it involves a backwards traversal.

These rules are further illustrated in the examples below.

Your task is still to find the number of valid paths from your starting position to your target position. However, you can now use any of the branching staircases.

For example, consider the following example with only 2 staircases.

S1 : 0 -> 6 : FROM START TO END
S2 : 2 -> 3 : FROM S1 TO S1

Possible Moves : 1, 3


In this example, there are two staircases: the main staircase (S1) and one branching staircase (S2). The branching staircase has 2 steps: S2_2 and S2_3.

Moving between staircases counts as one step traversed. Hence, the move S1_2 to S2_2 is a move of magnitude 1, and S1_2 to S2_3 is a move of magnitude 2.

In a move, you cannot return to a step that you have travelled from. For example, S1_2 to S2_2 to S1_2 is not a valid move as you return to S1_2.

You cannot return to a step that you have already passed in your path, so the path S1_2-S2_2-S1_2 is considered invalid, as it returns to step S1_2. Additionally, the path S1_0-S2_2-S1_2 is considered invalid, as you must pass S1_2 in the move S1_0-S2_2, so you cannot return to S1_2 in your path.

Branching staircases can cause moves to have many possible magnitudes. For example, the move S1_2-S1_3 has two different magnitudes. It can have magnitude 1 due to the route S1_2 to S1_3, or it can have magnitude 3 due to the route S1_2 to S2_2 to S2_3 to S1_3.

If at least one magnitude is valid, then the move is valid. Hence, the move S1_2-S1_3 is valid.

Despite the different possible intermediate routes of S1_2-S1_3, it is treated as one single move.

In this example, there are 17 valid paths from S1_0 to S1_6. The 17 valid paths are listed as follows.

S1_0-S1_1-S1_2-S1_3-S1_4-S1_5-S1_6
S1_0-S1_1-S1_2-S1_3-S1_6
S1_0-S1_1-S1_2-S1_5-S1_6
S1_0-S1_1-S1_2-S2_2-S1_4-S1_5-S1_6
S1_0-S1_1-S1_2-S2_2-S2_3-S1_3-S1_4-S1_5-S1_6
S1_0-S1_1-S1_2-S2_2-S2_3-S1_3-S1_6
S1_0-S1_1-S1_2-S2_2-S2_3-S1_5-S1_6
S1_0-S1_1-S1_4-S1_5-S1_6
S1_0-S1_1-S2_3-S1_3-S1_4-S1_5-S1_6
S1_0-S1_1-S2_3-S1_3-S1_6
S1_0-S1_1-S2_3-S1_5-S1_6
S1_0-S1_3-S1_4-S1_5-S1_6
S1_0-S1_3-S1_6
S1_0-S2_2-S1_4-S1_5-S1_6
S1_0-S2_2-S2_3-S1_3-S1_4-S1_5-S1_6
S1_0-S2_2-S2_3-S1_3-S1_6
S1_0-S2_2-S2_3-S1_5-S1_6


Hence, the answer for this example is 17.

Consider the other smaller example file:

S1 : 0 -> 6 : FROM START TO END
S2 : 2 -> 4 : FROM S1 TO S1
S3 : 3 -> 5 : FROM S2 TO S1

Possible Moves : 1, 2


As an example, S1_2 to S2_2 to S2_3 to S3_3 is a move of magnitude 3. However, it is not valid for this file, as 3 is not in this file’s list of valid magnitudes.

In this example, there are 102 valid paths from S1_0 to S1_6. Hence, the answer for this file is 102.

Finally, consider the same larger sample file:

S1 : 0 -> 99 : FROM START TO END
S2 : 8 -> 91 : FROM S1 TO S1
S3 : 82 -> 91 : FROM S1 TO S1
S4 : 90 -> 97 : FROM S2 TO S1
S5 : 29 -> 74 : FROM S1 TO S1
S6 : 87 -> 90 : FROM S3 TO S2
S7 : 37 -> 71 : FROM S2 TO S1
S8 : 88 -> 90 : FROM S6 TO S3
S9 : 34 -> 37 : FROM S2 TO S5
S10 : 13 -> 57 : FROM S1 TO S2

Possible Moves : 1, 3, 5, 6


In this example, there are 113524314072255566781694 valid paths from S1_0 to S1_99. Hence, the answer for this file is 113524314072255566781694.

Considering your file, what is the total number of valid paths from your starting location to the target location, if you can use all the branching staircases?
    </pre>
</body>
</html>